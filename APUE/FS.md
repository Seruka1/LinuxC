# 文件系统

## 目标

实例：类ls的实现,如myls -l -a -i -n

## 一、目录和文件

### 1. 获取文件属性

- stat 通过文件路径获取属性
- fstat 通过文件描述符获取属性
- lstat 面对符号链接文件时，获取的是符号🔗文件l的属性,而stat获取的是链接对象的属性
- 注意：在unix中文件大小 `size`只是一个属性，不一定代表文件真正的大小(与文件系统相关)

### 2. 文件访问权限

st_mode（rwxr--r--）总共16位，用于表示文件类型、文件访问权限、特殊权限位（粘住位、组用户设置位）

- 文件类型 dcb-lsp（7种文件类型，用3位表示）
  - 目录文件
  - 字符设备文件
  - 块设备文件
  - 常规文件
  - 符号链接文件
  - 套接字文件
  - 命名管道文件

### 3. umask

  作用：防止产生权限过松的文件

### 4. 文件权限的更改/管理

  在一个文件中想要运行一个脚本，那么可能需要改变文件的权限

- chmod

  - chmod a+x ??x ??x ??x
  - chmod u+x ??x ??? ???
  - chmod g+x ??? ??x ???
  - chmod o+x ??? ??? ??x

- fchmod

### 5. 粘住位

  t位：目前一般用于目录的设置，**只有对该目录具有写权限的用户并且满足下列条件之一**，才可以删除或者重命名该目录下的文件：

- 拥有此文件
- 拥有此目录
- 是超级用户

### 6. 文件系统：FAT,UFS

  文件或数据的存储和管理

### 7. 硬链接，符号链接

- link (命令) 创建硬链接其实就是在目录项中添加一条映射，存在限制：不能给分区建立，不能给目录建立。符号链接优点：可跨分区，可以给目录建立。
- ln() => ln
- unlink() 删除一个文件的硬连接 但并不是删除文件 只有当一个文件的硬链接数为0 且没有进程占用该文件时一个文件才有被删除的可能（数据可被随意改写）

### 8. utime

  可以更改文件最后读的时间和改的时间。

### 9. 目录的创建与销毁

- mkdir
- rmdir

### 10. 更改当前工作目录

- chdir
- fchdir

### 11. 分析目录/读取目录内容

## 二、系统数据文件和信息

## 三、进程环境
